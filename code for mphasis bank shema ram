CREATE TABLE MPHASIS_DEPT (
    D_ID NUMBER PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR2(20)
    );
insert into mphasis_dept values(1,'deposit_dept');
insert into mphasis_dept values(2,'loan_dept');
select * from mphasis_dept;


CREATE SEQUENCE E_ID1_SEQ 
START WITH 105
INCREMENT BY 1;

drop table mphasis_bank_emp;

CREATE TABLE MPHASIS_BANK_EMP (
E_ID NUMBER PRIMARY KEY,
F_NAME VARCHAR2 (20),
L_NAME VARCHAR2 (20),
EMP_DOB VARCHAR2 (20),
EMP_EMAIL VARCHAR2 (30),
USER_NAME VARCHAR2 (20) UNIQUE NOT NULL,
PASSWORD CHAR (32),
ADDRESS VARCHAR2 (40),
D_NO REFERENCES MPHASIS_DEPT (D_ID)
); 
insert into mphasis_bank_emp values(e_id1_seq.nextval,'uday','kiran','31-feb-1997','vinay@mphasis.com','RAHUL123','ram','pune',2);
select * from mphasis_bank_emp

 create or replace sequence b_id_seq start with 1005 increment by 1;
CREATE SEQUENCE BRANCH_ID1_SEQ 
START WITH 1005
INCREMENT BY 1;

 
CREATE TABLE MPHASIS_BANK_BRANCH (
BRANCH_ID NUMBER PRIMARY KEY,
BRANCH_NAME VARCHAR2 (50),
BRANCH_LOCATION VARCHAR2 (50),
BRANCH_MGR_ID  REFERENCES MPHASIS_BANK_EMP (E_ID)
);
insert into mphasis_bank_branch values(BRANCH_ID1_SEQ.NEXTVAL,'colony','bhimavaram',105);
select * from mphasis_bank_branch;


CREATE SEQUENCE CUST_ACCOUNT_SEQ 
START WITH 1000
INCREMENT BY 100;


CREATE TABLE MPHASIS_BANK_CUST (
ACCOUNT_NO NUMBER,
F_NAME VARCHAR2 (20),
L_NAME VARCHAR2 (20),
CUST_DOB DATE,
CUST_EMAIL VARCHAR2 (20),
USER_NAME VARCHAR2 (20) UNIQUE NOT NULL,
PASSWORD CHAR (32),
ADDRESS VARCHAR2 (40),
ACCOUNT_TYPE VARCHAR2 (20),
BALLANCE NUMBER (7,2),
DATE_CREATED DATE,
CONSTRAINT PK_MPHASIS_BANK_CUST PRIMARY KEY (ACCOUNT_NO),
CONSTRAINT MPHASIS_ACC_TYPE CHECK (ACCOUNT_TYPE IN ('SAVINGS', 'FIXED DEPOSIT', 'LOAN')) 
);
alter table mphasis_bank_cust modify date_created date;
drop table mphasis_bank_cust;
insert into mphasis_bank_cust(ACCOUNT_NO,F_NAME,L_NAME,CUST_DOB,CUST_EMAIL,USER_NAME,PASSWORD,ADDRESS,ACCOUNT_TYPE,BALLANCE,DATE_CREATED) values (21234322,'KIRAN','KUMAN','08-JAN-1998','KIRAN@MPHASIS.COM','KIRAN123','123','HYD','SAVINGS',30000,'03-nov-2020');
SELECT * FROM MPHASIS_BANK_CUST

create or replace function "REGISTERFUNCTIONCUSTOMER"
(F_name IN VARCHAR2,
CUST_dob IN 

ADDRESS IN VARCHAR2)
return VARCHAR2
is cusid varchar2(2000);
begin
SELECT 'MPH' || SUBSTR(F_NAME, -2,2)||SUBSTR(CUST_DOB,-2,2) || CUST_ACCOUNT_SEQ.NEXTVAL INTO CUSID FROM DUAL;
return cusid;
end;
--------------------------------------------------------------------------------
declare
k varchar2(2000);
begin
k:=REGISTERFUNCTIONCUSTOMER('kiran','01-jan-2011','bang');
dbms_output.put_line('result:'||k);
end;
select * from mphasis_bank_cust;


CREATE SEQUENCE CUST_TRANSACTION_SEQ
START WITH 1
INCREMENT BY 1;
  

CREATE SEQUENCE CUST_TRANSACTION_POS_SEQ
START WITH 10
INCREMENT BY 10;

CREATE TABLE MPHASIS_TRANSACTION_CUST (
T_ID NUMBER,
ACC_NO REFERENCES MPHASIS_BANK_CUST (ACCOUNT_NO),
POS NUMBER,
T_DATE DATE DEFAULT SYSDATE,
AMOUNT NUMBER (7,2),
 PRIMARY KEY (T_ID))
insert into mphasis_transaction_cust VALUES(CUST_TRANSACTION_SEQ.nextval,21234322,CUST_TRANSACTION_POS_SEQ.nextval,sysdate,2400);
select * from mphasis_transaction_cust;
update mphasis_bank_cust set ballance=ballance+3000 where account_no=21234322;
select * from mphasis_bank_cust;

CREATE OR REPLACE TRIGGER TRANSACTION_UPDATE
AFTER 
INSERT
ON MPHASIS_TRANSACTION_CUST
BEGIN
	UPDATE MPHASIS_BANK_CUST SET BALLANCE = 5000 + (SELECT AMOUNT FROM MPHASIS_TRANSACTION_CUST WHERE ACC_NO =21234322 );  
END;

CREATE TABLE CUSTOMERS (
CUSTOMER_ID CHAR(10),
CUSTOMER_NAME VARCHAR2 (30),
AGE NUMBER,
PAN_NUMBER CHAR(8),
CONSTRAINT CHECK_CUST_ID CHECK (CUSTOMER_ID LIKE 'MLA%'),
CONSTRAINT CHECK_PAN_NUM CHECK (PAN_NUMBER LIKE '%['A-Z']['A-Z']['A-Z']['A-Z']['0-9']['0-9']['0-9']['0-9']%')
)


